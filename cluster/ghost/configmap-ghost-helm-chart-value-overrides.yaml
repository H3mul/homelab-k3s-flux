apiVersion: v1
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: ghost-helm-chart-value-overrides
  namespace: ghost
data:
  values.yaml: |-
    initContainers:
      init-db:
        image: ghcr.io/h3mul/mysql-init:rolling@sha256:e8445b5941fdf25cf8083887e9b0235247d875c34fa7a854adb3933142e7a22f
        imagePullPolicy: IfNotPresent
        env:
          - name: INIT_MYSQL_HOST
            value: main-mysql.mysql-operator.svc.cluster.local
          - name: INIT_MYSQL_SUPER_USER
            value: root
          - name: INIT_MYSQL_SUPER_PASS
            valueFrom:
              secretKeyRef:
                name: mysql-main
                key: ROOT_PASSWORD
          - name: INIT_MYSQL_DBNAME
            valueFrom:
              secretKeyRef:
                name: ghost-mysql-credentials
                key: MYSQL_DBNAME
          - name: INIT_MYSQL_USER
            valueFrom:
              secretKeyRef:
                name: ghost-mysql-credentials
                key: MYSQL_USER
          - name: INIT_MYSQL_PASS
            valueFrom:
              secretKeyRef:
                name: ghost-mysql-credentials
                key: MYSQL_PASS

    image:
      repository: ghost
      tag: 5.54.4
    env:
      - name: TZ
        value: ${TIMEZONE}

      - name: url
        value: "https://blog.${CLUSTER_DOMAIN}"

      - name: database__client
        value: mysql

      - name: database__connection__host
        value: main-mysql.mysql-operator.svc.cluster.local

      - name: database__connection__database
        valueFrom:
          secretKeyRef:
            name: ghost-mysql-credentials
            key: MYSQL_DBNAME

      - name: database__connection__user
        valueFrom:
          secretKeyRef:
            name: ghost-mysql-credentials
            key: MYSQL_USER

      - name: database__connection__password
        valueFrom:
          secretKeyRef:
            name: ghost-mysql-credentials
            key: MYSQL_PASS

      - name: NODE_ENV
        value: production 

    ingress:
      main:
        enabled: true
        ingressClassName: nginx
        hosts:
          - host: &host blog.${CLUSTER_DOMAIN}
            paths:
              - path: /
        tls:
        - secretName: letsencrypt-wildcard-cert-prod
          hosts:
          - *host

    service:
      main:
        ports:
          http:
            port: 2368

    # persistence:
    #   content:
    #     enabled: true
    #     mountPath: /var/lib/ghost/content
    #     type: pvc
    #     storageClass: ceph-block
    #     size: 2Gi
